

# Feature Engineering Reference

This document describes every column produced by our **compute features** pipeline for cryptocurrency scalp‑trading datasets.  
It is split into two parts:

1. **Original Feature Set** – the columns that existed prior to 2025‑05‑23.  
2. **v2 Extension (Proportional & Normalised)** – the new, strictly scale‑invariant features added on 2025‑05‑23.

For each feature you will find:

| Field | Type | Formula / Definition | Typical Range | ML Considerations |
|-------|------|----------------------|---------------|-------------------|

- **Type**  
  - **Label** – not used as an input.  
  - **Absolute** – raw values whose magnitude depends on the asset (should be removed or normalised for cross‑asset models).  
  - **Proportional** – scale‑free by construction.  
  - **Quasi‑Abs** – bounded indicators (e.g. RSI) that are comparable across assets.

---

## 1. Original Feature Set

### 1.1 Meta

| Field | Type | Definition |
|-------|------|------------|
| `OpenTime` | timestamp | UNIX Epoch millis at candle open (UTC). Not fed to the model directly. |
| `openposition` | **Label** | `True` = open long, `False` = flat/short – generated by label pipeline. |

### 1.2 Price‑Derived

| Field | Type | Formula / Definition | Typical Range | Notes |
|-------|------|----------------------|---------------|-------|
| `return_pct` | **Proportional** | `(Close_t − Close_{t‑1}) / Close_{t‑1}` | ~[‑5 %, +5 %] per minute | Primary momentum signal. |
| `high_low_ratio` | **Proportional** | `High / Low` | ≥ 1.0 (≈ 1 – 1.05) | Intracandle volatility. |
| `candle_body` | **Absolute** | `|Close − Open|` | 0 – 100 000+ (BTC) | Size depends on quote currency. |
| `candle_direction` | **Proportional** | `sign(Close − Open)` (‑1/0/+1) | {‑1, 0, +1} | Encodes bullish / bearish. |
| `upper_wick` / `lower_wick` | **Absolute** | `High − max(Open, Close)` / `min(Open, Close) − Low` | asset‑scale | Raw wick length. |
| `upper_wick_ratio` / `lower_wick_ratio` | **Proportional** | Wick ÷ Body | 0 – 20 | Shape of the candle. |
| `wick_to_body_ratio` | **Proportional** | `(upper + lower) / body` | 0 – 20 | Compares total wick length to body. |
| `price_change` | **Absolute** | `Close − Open` | asset‑scale | Redundant w/ `return_pct`. |

### 1.3 Volume & Order‑Flow

| Field | Type | Definition | Typical Range | Notes |
|-------|------|------------|---------------|-------|
| `buy_ratio` | **Proportional** | `BuyVolume / Volume` | 0–1 | Aggressive buy dominance. |
| `quote_volume_ratio` | **Proportional** | `QuoteVolume / Volume` | ≈ price | Close proxy to VWAP price. |
| `trade_density` | **Proportional** | `TradeCount / Volume` | depends | Smaller numbers → bigger trades. |
| `taker_buy_intensity` | **Proportional** | `(TakerBuyVol − TakerSellVol) / Volume` | ‑1 – +1 | Order‑flow imbalance. |
| `avg_trade_size` | **Absolute** | `Volume / TradeCount` | asset‑scale | Needs normalisation. |

### 1.4 Technical Indicators

| Field | Type | Formula / Definition | Range | Notes |
|-------|------|----------------------|-------|-------|
| `ema_8`, `ema_21` | **Absolute** | 8 / 21‑period exponential moving averages of `Close`. | asset‑scale | Normalised in v2. |
| `rsi_6`, `rsi_14` | **Quasi‑Abs** | RSI on 6 / 14 periods. | 0 – 100 | Already bounded. |
| `vwap` | **Absolute** | Cumulative (PV) / cumulative V – Binance style. | asset‑scale | Normalised in v2. |

---

## 2. v2 Extension (2025‑05‑23)

All new columns are **strictly scale‑invariant** so the same model can be trained on any instrument without rescaling.

### 2.1 Candle Geometry Ratios

| Field | Formula | Interpretation |
|-------|---------|----------------|
| `candle_range` | `High − Low` (helper) | Raw span of candle. |
| `candle_body_pct` | `candle_body / candle_range` | Body proportion of total range (0–1). |
| `upper_wick_pct` | `upper_wick / candle_range` | Upper wick share (0–1). |
| `lower_wick_pct` | `lower_wick / candle_range` | Lower wick share (0–1). |

**Why:** Shape distributions are comparable across assets; absolute numbers are not.

### 2.2 Price Ratio Features

| Field | Formula | Typical Range | Signal |
|-------|---------|---------------|--------|
| `close_open_ratio` | `Close / Open` | ≈ 0.98 – 1.02 | Minute momentum. |
| `high_close_ratio` | `High / Close` | ≥ 1 | Proximity to high. |
| `low_close_ratio`  | `Low / Close`  | ≥ 1 | Proximity to low (invert measures). |

### 2.3 Moving‑Average Relationships

| Field | Formula | Why it matters |
|-------|---------|----------------|
| `close_ema8_ratio`  | `Close / EMA_8` | Fast trend alignment. |
| `close_ema21_ratio` | `Close / EMA_21` | Medium trend alignment. |
| `ema8_ema21_ratio`  | `EMA_8 / EMA_21` | Trend slope (MACD‑like). |
| `close_vwap_ratio`  | `Close / VWAP` | Institutional mean‑reversion anchor. |

All ratios hover around **1.0**; deviations highlight overbought/oversold states.

### 2.4 Volume Normalisation

| Field | Formula | Comment |
|-------|---------|---------|
| `volume_mean_24h` | Rolling μ<sub>24 h</sub>(Volume) | Context baseline. |
| `volume_std_24h`  | Rolling σ<sub>24 h</sub>(Volume) | Dispersion. |
| `volume_zscore_24h` | `(Volume − μ) / σ` | Scale‑free spike detector. |

### 2.5 Volatility

| Field | Definition |
|-------|------------|
| `return_pct_vol_30m` | Rolling 30‑sample (≈ 30 min) std‑dev of `return_pct`. |

Useful to modulate position sizing or filter trades when noise is high.

### 2.6 Temporal Cycles

| Field | Encoding | Purpose |
|-------|----------|---------|
| `minute_sin`, `minute_cos` | `sin/cos(2π·minute/60)` | Minute‑within‑hour cyclic pos‑enc. |
| `hour_sin`, `hour_cos`     | `sin/cos(2π·hour/24)`   | Hour‑of‑day pattern capture. |

These allow the network to learn diurnal volume/volatility rhythms without leaking absolute timestamps.

---

## 3. Implementation Notes

* **Division by zero** is handled via `_safe_div` – denominators of `0` yield `0` instead of ±∞.  
* All v2 features are appended; **no original columns were deleted** to preserve backward compatibility.  
* The final export column order (see pipeline) ensures deterministic parquet schemas for downstream loading.

---

## 4. Future Work

| Idea | Rationale |
|------|-----------|
| **Percentile‑rank volume** (0–1) | Smoother than Z‑score for heavy‑tailed distributions. |
| **ATR‑normalised ranges** | Use Average True Range to scale candles adaptively. |
| **Order‑book imbalance** | Depth‑derived metrics once Level‑2 data is stored. |
| **Session‑based encodings** | Asia / EU / US session flags instead of pure clock cycles. |

*Suggestions welcome!*

---